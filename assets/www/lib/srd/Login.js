//>>built
define("srd/Login","dojo/_base/declare,dojo,dojox,dojo/request/xhr,dijit/dijit,dojo/parser,dojo/selector/acme,dijit/TitlePane,dijit/Toolbar,dijit/form/Button,dojox/form/CheckedMultiSelect,dojox/io/xhrScriptPlugin,dojo/data/ItemFileReadStore,dojox/data/CsvStore,dijit/MenuBar,dijit/PopupMenuBarItem,dijit/MenuItem,dijit/Menu,dijit/form/SimpleTextarea,dijit/form/TextBox,dijit/form/CheckBox,dijit/layout/TabContainer,dijit/layout/ContentPane,dojo/hash,dojox/io/xhrScriptPlugin,dojo/data/ItemFileReadStore,dojox/mobile/RoundRectDataList,dijit/form/DataList,dojox/mobile/ComboBox,dojox/mobile/ToolBarButton,dijit/layout/ContentPane,dijit/form/Form,dojox/mobile/TextBox,dojox/mobile/Button,dojox/mobile/RoundRectCategory,dojox/widget/Standby,dojox/mobile/TabBar,dojox/mobile/TabBarButton,dojox/mobile/RoundRectDataList,dojox/mobile/RoundRectList,dojox/mobile/TextBox,dojox/mobile/CheckBox,dojox/mobile/ScrollableView,dojox/mobile/TabBar,dijit/Dialog,dojox/widget/Standby,dijit/form/MultiSelect".split(","),
function(f,a,g,h){return f([],{constructor:function(){this.myservers=window.localStorage.getItem("myservers")?a.fromJson(window.localStorage.getItem("myservers")):[];if(0==this.myservers.length)this.myservers=[{url:"demo.sitrep.org",city:"New York",username:"SitRepDemo",password:"SRDemo115"}];this.deletepressed=this.clickedservernum=this.currentservernum=0;this.uiSetup()},uiSetup:function(){0<this.myservers.length&&(a.setAttr(a.byId("userbox"),"value",this.myservers[0].username),a.setAttr(a.byId("passbox"),
"value",this.myservers[0].password));this.theSelect=a.create("select",{id:"selectbox",onchange:function(){this.selectserver(this.theSelect.selectedIndex)}.bind(this)},a.byId("serverListLocation1"));this.theSelect2=a.create("select",{id:"selectbox2",onchange:function(){this.selectserver(this.theSelect2.selectedIndex)}.bind(this)},a.byId("serverListLocation2"));for(i=0;i<this.myservers.length;i++)a.create("option",{innerHTML:this.myservers[i].url},this.theSelect),a.create("option",{innerHTML:this.myservers[i].url},
this.theSelect2)},saveToLocalStorage:function(){window.localStorage.setItem("myservers",a.toJson(this.myservers))},updateUserandPass:function(b){this.currentservernum=b;0<=!b?(a.setAttr(a.byId("userbox"),"value",""),a.setAttr(a.byId("passbox"),"value","")):(a.setAttr(a.byId("userbox"),"value",this.myservers[b].username),a.setAttr(a.byId("passbox"),"value",this.myservers[b].password))},connectToServer:function(){document.getElementById("loginfeedback").innerHTML="";var b=new g.widget.Standby({target:"root_view"});
document.body.appendChild(b.domNode);b.startup();b.show();var c=a.getAttr(a.byId("userbox"),"value"),e=a.getAttr(a.byId("passbox"),"value");serverBaseUrl="http://"+this.myservers[this.currentservernum].url;var d=serverBaseUrl+"/login/index/embeddedlogin",c={timeout:4E3,method:"POST",data:a.toJson({username:c,password:e}),handleAs:"json",headers:{"Content-Type":"application/json"}};h(d,c).then(function(a){b.hide();if(null!=a&&null!=a.authenticated&&null!=a.authorized)if(!0==a.authenticated&&!0==a.authorized)window.location.href=
serverBaseUrl;else if(!0!=a.authenticated)document.getElementById("loginfeedback").innerHTML="Invalid username or password!";else{if(!0!=a.authorized)document.getElementById("loginfeedback").innerHTML="This user is not authorized to connect to this server!"}else document.getElementById("loginfeedback").innerHTML="Error: could not connect to server!"}.bind(this),function(a){b.hide();document.getElementById("loginfeedback").innerHTML="Error: An unknown error occured:"+a})},loadSitRepFrame:function(){dijit.byId("targetPane").set("content",
a.create("iframe",{src:"main_frame.html",style:"border: 0; width: 100%; height: 100%"}))},selectserver:function(b){document.getElementById("loginfeedback").innerHTML="";this.currentservernum=b;0<=b?(a.setAttr(a.byId("userbox"),"value",this.myservers[b].username),a.setAttr(a.byId("passbox"),"value",this.myservers[b].password),a.setAttr(a.byId("editservername"),"value",this.myservers[b].url),a.setAttr(a.byId("editusername"),"value",this.myservers[b].username),a.setAttr(a.byId("editpassword"),"value",
this.myservers[b].password),a.setAttr(a.byId("editcity"),"value",this.myservers[b].city),a.setAttr(a.byId("confirmtext"),"innerHTML","server "+b+" is "),this.deactivatesave()):(a.setAttr(a.byId("userbox"),"value",""),a.setAttr(a.byId("passbox"),"value",""),a.setAttr(a.byId("editservername"),"value",""),a.setAttr(a.byId("editusername"),"value",""),a.setAttr(a.byId("editpassword"),"value",""),a.setAttr(a.byId("editcity"),"value",""))},addToSelectBox:function(a){var c=document.getElementById("selectbox"),
e=document.getElementById("selectbox2"),d=document.createElement("option");d.innerText=this.myservers[a].url;c.appendChild(d);e.appendChild(d)},addNewServer:function(){this.myservers.push({url:"edit.sitrep.org",city:"Anytown",username:"",password:""});this.currentservernum=this.myservers.length-1;this.addServer()},addServer:function(){var b=this.currentservernum,c=document.createElement("option");c.innerHTML=this.myservers[b].url;a.byId("selectbox").appendChild(c);a.byId("selectbox").selectedIndex=
b;a.byId("selectbox2").appendChild(c);a.byId("selectbox2").selectedIndex=b;this.selectserver(b);this.saveserver()},deleteserverprep:function(){document.getElementById("confirmtext").innerHTML="Are you sure you want to delete "+this.myservers[this.currentservernum].url+"?";myDialog.show()},deleteserver:function(){this.myservers.splice(this.currentservernum,1);a.byId("selectbox").remove(this.currentservernum);a.byId("selectbox2").remove(this.currentservernum);this.currentservernum=document.getElementById("selectbox").selectedIndex;
this.saveToLocalStorage()},saveserver:function(){this.myservers[this.currentservernum].url=document.getElementById("editservername").value;this.myservers[this.currentservernum].city=document.getElementById("editcity").value;this.myservers[this.currentservernum].username=document.getElementById("editusername").value;this.myservers[this.currentservernum].password=document.getElementById("editpassword").value;this.saveToLocalStorage();a.byId("selectbox").options[this.currentservernum].innerHTML=this.myservers[this.currentservernum].url;
a.byId("selectbox2").options[this.currentservernum].innerHTML=this.myservers[this.currentservernum].url;this.deactivatesave()},activatesave:function(){document.getElementById("savetext").innerHTML="  Click Save to save changes.";dijit.byId("savebutton").setAttribute("disabled",!1)},deactivatesave:function(){dijit.byId("savebutton").setAttribute("disabled",!0);document.getElementById("savetext").innerHTML=""}})});